C251 COMPILER V5.60.0,  misc                                                               14/03/22  14:48:16  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE misc
OBJECT MODULE PLACED IN .\Output\misc.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE User\misc.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE INCDIR(.\Code;.\Lib\li
                    -braries;.\Lib\seekfree_libraries;.\Lib\seekfree_peripheral;.\User) DEFINE(USE_8701E) DEBUG PRINT(.\Output\misc.lst) OBJE
                    -CT(.\Output\misc.obj) 

stmt  level    source

    1          /*  code=utf-8
    2              Project Hikari 杂项函数
    3          */
    4          #include "misc.h"
    5          #include "key.h"
    6          #include "buzz.h"
    7          #include "encoder.h"
    8          #include "servo.h"
    9          #include "motor.h"
   10          #include "indNavi.h"
   11          
   12          //杂项周期计数器
   13          volatile timeDataType misc_tick;
   14          //系统警报状态
   15          volatile alertState_enum sysAlertState;
   16          //驱动刷新标记
   17          volatile bit drvFlag;
   18          //电池电压
   19          float battVoltage;
   20          
   21          //系统启动
   22          void system_init(void)
   23          {
   24   1          //关闭中断功能
   25   1          DisableGlobalIRQ();
   26   1      
   27   1          //设置运行频率
   28   1          sys_clk = SysTimeClock_Hz;
   29   1          //主板启动
   30   1          board_init();
   31   1          //初始化延时
   32   1          delay_init();
   33   1      
   34   1          //初始化系统警报
   35   1          sysAlertState = S_A0;
   36   1          //初始化电池检测
   37   1          adc_init(BATT, ADC_SYSclk_DIV_32);
   38   1          //初始化蜂鸣器
   39   1          buzzInit();
   40   1      
   41   1          //初始化电机定时周期
   42   1          pit_timer_ms(TIM_1, PITD);
   43   1          //初始化前瞻电感采集
   44   1          indInit();
   45   1          //初始化编码器
   46   1          encoderInit();
   47   1          //初始化电机
   48   1          motorInit();
   49   1          //初始化舵机
   50   1          servoInit();
   51   1      
   52   1          //初始化杂项定时周期
   53   1          pit_timer_ms(TIM_4, PITM);
   54   1          misc_tick = 0;
   55   1          //初始化显示屏
   56   1          lcd_init();
   57   1      
C251 COMPILER V5.60.0,  misc                                                               14/03/22  14:48:16  PAGE 2   

   58   1          //启动中断功能
   59   1          EnableGlobalIRQ();
   60   1      
   61   1          //显示启动信息
   62   1          lcd_showstr(0, 0, "Project Hikari");
   63   1          lcd_showstr(0, 1, "Compiled in");
   64   1          lcd_showstr(0, 2, __DATE__);
   65   1          lcd_showstr(0, 3, __TIME__);
   66   1      
   67   1          //发送启动信息
   68   1          printf("Project Hikari Load OK\n");
   69   1      
   70   1          //本机提示完成
   71   1          delay_ms(1000);
   72   1          beepShort();
   73   1          lcd_clear(WHITE);
   74   1      }
   75          //核心轮询功能
   76          void system_loop(void)
   77          {
   78   1          //获取电池电压
   79   1          battVoltage = (adc_once(BATT, ADC_8BIT) * 20.0) / 256;
   80   1          lcd_showfloat(40, 1, battVoltage, 1, 2);
   81   1          //电池检测
   82   1          if (battVoltage < BATTMIN && battVoltage > 3)
   83   1              sysAlertState = S_A1;
   84   1          if (battVoltage > BATTMAX)
   85   1              sysAlertState = S_A2;
   86   1      
   87   1          //按键处理
   88   1          updateKey();
   89   1          keyProg();
   90   1          //拨码开关处理
   91   1          swProg();
   92   1          //系统警报处理
   93   1          switch (sysAlertState)
   94   1          {
   95   2          case S_A1:
   96   2              lcd_clear(WHITE);
   97   2              lcd_showstr(0, 0, "Error: Low Battery");
   98   2              printf("Low Battery, STOP");
   99   2              motor0DirectCtrl(0);
  100   2              motor1DirectCtrl(0);
  101   2              beepAlert();
  102   2              while (1)
  103   2                  ;
  104   2              break;
  105   2          case S_A2:
  106   2              lcd_clear(WHITE);
  107   2              printf("Too High Voltage, STOP");
  108   2              lcd_showstr(0, 0, "Error: Too High Voltage");
  109   2              motor0DirectCtrl(0);
  110   2              motor1DirectCtrl(0);
  111   2              beepAlert();
  112   2              while (1)
  113   2                  ;
  114   2              break;
  115   2          default:
  116   2              break;
  117   2          }
  118   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       423     ------
  ecode size           =    ------     ------
C251 COMPILER V5.60.0,  misc                                                               14/03/22  14:48:16  PAGE 3   

  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         8     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       156     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
