C251 COMPILER V5.60.0,  key                                                                14/03/22  14:46:07  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE key
OBJECT MODULE PLACED IN .\Output\key.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE User\key.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE INCDIR(.\Code;.\Lib\lib
                    -raries;.\Lib\seekfree_libraries;.\Lib\seekfree_peripheral;.\User) DEFINE(USE_8701E) DEBUG PRINT(.\Output\key.lst) OBJECT
                    -(.\Output\key.obj) 

stmt  level    source

    1          /*  code=utf-8
    2              Project Hikari 按键与拨码开关
    3          */
    4          #include "key.h"
    5          //状态枚举
    6          volatile keyState_enum keyState[keyNum];
    7          //引入周期计数器
    8          extern volatile timeDataType misc_tick;
    9          //按键按下时间戳
   10          timeDataType keyPressTimestamp[keyNum];
   11          //按键状态更新
   12          void updateKey(void)
   13          {
   14   1          uint8 i = keyNum;
   15   1          uint8 keyInfo =
   16   1              (((uint8)Key0) << 0) +
   17   1              (((uint8)Key1) << 1) +
   18   1              (((uint8)Key2) << 2) +
   19   1              (((uint8)Key3) << 3);
   20   1          while (i--)
   21   1          {
   22   2              if (!(keyInfo & (1 << i)))
   23   2              {
   24   3                  switch (keyState[i])
   25   3                  {
   26   4                  case S0:
   27   4                      keyState[i] = S2;
   28   4                      keyPressTimestamp[i] = misc_tick;
   29   4                      break;
   30   4                  case S2:
   31   4                      break;
   32   4                  default:
   33   4                      keyState[i] = S0;
   34   4                      break;
   35   4                  }
   36   3              }
   37   2              if (keyInfo & (1 << i))
   38   2              {
   39   3                  switch (keyState[i])
   40   3                  {
   41   4                  case S2:
   42   4                      if (misc_tick - keyPressTimestamp[i] >= keyLongPressTime)
   43   4                          keyState[i] = S3;
   44   4                      else if (misc_tick - keyPressTimestamp[i] >= keyShortPressTime)
   45   4                          keyState[i] = S1;
   46   4                      else
   47   4                          keyState[i] = S0;
   48   4                      break;
   49   4                  default:
   50   4                      keyState[i] = S0;
   51   4                      break;
   52   4                  }
   53   3              }
   54   2          }
   55   1      }


C251 COMPILER V5.60.0,  key                                                                14/03/22  14:46:07  PAGE 2   

Module Information          Static   Overlayable
------------------------------------------------
  code size            =       186     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        16     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
